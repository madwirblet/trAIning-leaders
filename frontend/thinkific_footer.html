<style>
#ai-chat-widget {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 350px;
    height: 450px;
    background: white;
    border: 1px solid #ddd;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
    font-family: sans-serif;
    z-index: 1000;
}

#chat-header {
    background: #007bff;
    color: white;
    padding: 10px;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
}

#chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    border-bottom: 1px solid #eee;
}

#chat-messages div {
    margin-bottom: 10px;
    padding: 8px;
    background: #f5f5f5;
    border-radius: 5px;
    word-wrap: break-word;
}

#chat-input-area {
    display: flex;
    gap: 5px;
    padding: 10px;
    border-top: 1px solid #eee;
}

#user-input {
    flex: 1;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
}

#send-btn {
    padding: 8px 15px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
}

#send-btn:hover {
    background: #0056b3;
}
</style>
<div id="ai-chat-widget">
    <div id="chat-header">Leadership Course Assistant</div>
    <div id="chat-messages" role="log" aria-live="polite"></div>
    <div id="chat-input-area">
        <input type="text" id="user-input" placeholder="Ask a question about the lecture..." aria-label="Chat input">
        <button id="send-btn" aria-label="Send message">Send</button>
    </div>
</div>
<script>
(function() {
    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeChat);
    } else {
        initializeChat();
    }

    function initializeChat() {
        const sendBtn = document.getElementById('send-btn');
        const userInput = document.getElementById('user-input');
        const chatMessages = document.getElementById('chat-messages');

        if (!sendBtn || !userInput) {
            console.error('Chat widget elements not found');
            return;
        }

        // Send message on button click
        sendBtn.addEventListener('click', sendMessage);

        // Send message on Enter key
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        async function sendMessage() {
            const question = userInput.value.trim();
            if (!question) return;

            // Add user message to UI
            appendMessage('User', question, chatMessages);
            userInput.value = '';
            userInput.focus();

            try {
                // Call your backend
                const response = await fetch('https://your-api-url.com/query', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: question })
                });

                if (!response.ok) throw new Error(`API error: ${response.status}`);

                const data = await response.json();
                appendMessage('AI', data.response, chatMessages);
            } catch (error) {
                appendMessage('System', `Error: ${error.message}`, chatMessages);
                console.error('Chat error:', error);
            }
        }
    }

    function appendMessage(sender, text, container) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `chat-message chat-message-${sender.toLowerCase()}`;
        msgDiv.innerHTML = `<strong>${sender}:</strong> ${escapeHtml(text)}`;
        container.appendChild(msgDiv);
        // Auto-scroll to bottom
        container.scrollTop = container.scrollHeight;
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
})()
</script>